# 05. 常用命令速查

## 一、ROS 命令

### 话题相关

```bash
# 查看所有话题
rostopic list

# 查看话题内容（实时输出）
rostopic echo /mavros/state
rostopic echo /mavros/local_position/pose

# 查看话题类型
rostopic type /mavros/state
# 输出: mavros_msgs/State

# 查看话题发布频率
rostopic hz /mavros/local_position/pose
# 输出: average rate: 30.0

# 查看话题详细信息（发布者/订阅者）
rostopic info /mavros/state

# 手动发布消息（测试用）
rostopic pub /mavros/setpoint_position/local geometry_msgs/PoseStamped \
  "header:
    stamp: now
    frame_id: 'map'
  pose:
    position: {x: 0.0, y: 0.0, z: 2.0}
    orientation: {x: 0.0, y: 0.0, z: 0.0, w: 1.0}"
```

### 消息相关

```bash
# 查看消息类型的字段
rosmsg show mavros_msgs/State
rosmsg show geometry_msgs/PoseStamped

# 查看所有消息类型
rosmsg list
```

### 节点相关

```bash
# 查看所有节点
rosnode list

# 查看节点信息
rosnode info /mavros

# 杀死节点
rosnode kill /mavros
```

### 服务相关

```bash
# 查看所有服务
rosservice list

# 调用服务（切换模式）
rosservice call /mavros/set_mode "custom_mode: 'OFFBOARD'"

# 调用服务（解锁）
rosservice call /mavros/cmd/arming "value: true"
```

### 启动相关

```bash
# 启动 launch 文件
roslaunch mavros px4.launch fcu_url:="udp://:14540@127.0.0.1:14557"

# 启动 roscore（通常自动启动）
roscore

# 运行单个节点
rosrun package_name node_name
```

---

## 二、PX4 命令 (pxh>)

### 飞行控制

```bash
# 查看状态
pxh> commander status

# 手动解锁
pxh> commander arm

# 手动上锁
pxh> commander disarm

# 起飞
pxh> commander takeoff

# 降落
pxh> commander land

# 切换模式
pxh> commander mode offboard
pxh> commander mode manual
pxh> commander mode posctl
```

### 参数设置

```bash
# 查看参数
pxh> param show COM_RCL_EXCEPT
pxh> param show COM_*         # 通配符

# 设置参数
pxh> param set COM_RCL_EXCEPT 4    # 允许无遥控器 OFFBOARD
pxh> param set NAV_RCL_ACT 0       # 遥控器丢失时不触发 failsafe
pxh> param set NAV_DLL_ACT 0       # 数据链路丢失时不触发 failsafe
pxh> param set COM_ARM_WO_GPS 1    # 允许无 GPS 解锁

# 保存参数到文件
pxh> param save

# 重置参数为默认值
pxh> param reset_all
```

### 传感器信息

```bash
# 查看传感器状态
pxh> sensors status

# 查看 IMU 数据
pxh> listener sensor_accel
pxh> listener sensor_gyro

# 查看 GPS 数据
pxh> listener vehicle_gps_position
```

### 日志和调试

```bash
# 查看系统日志
pxh> dmesg

# 查看模块列表
pxh> top

# 查看帮助
pxh> help
pxh> commander help
```

---

## 三、Gazebo 命令

### 命令行工具

```bash
# 启动空世界
gazebo --verbose

# 暂停仿真
gz world -p 1

# 继续仿真
gz world -p 0

# 重置仿真
gz world -r

# 查看模型列表
gz model -l

# 删除模型
gz model -m model_name -d
```

### 快捷键

```
Gazebo 窗口中：
- 鼠标左键拖动: 旋转视角
- 鼠标中键拖动: 平移视角
- 鼠标滚轮: 缩放
- R: 选择模型后，切换旋转模式
- T: 选择模型后，切换平移模式
- Esc: 取消选择
- Ctrl+R: 重置仿真
- 空格: 暂停/继续
```

---

## 四、Git 命令

```bash
# 克隆仓库
git clone https://github.com/xxx/repo.git

# 更新代码
git pull

# 查看状态
git status

# 添加文件
git add .
git add filename

# 提交
git commit -m "描述信息"

# 推送
git push

# 查看分支
git branch

# 切换分支
git checkout branch_name

# 查看日志
git log --oneline
```

---

## 五、Python/pip 命令

```bash
# 安装包
pip3 install numpy matplotlib

# 查看已安装包
pip3 list

# 运行 Python 脚本
python3 script.py

# 进入 Python 交互环境
python3
```

---

## 六、系统命令

```bash
# 查看进程
ps aux | grep px4
ps aux | grep ros

# 杀死进程
kill -9 PID
killall px4
killall gzserver

# 查看端口占用
netstat -tuln | grep 14540

# 查看环境变量
echo $ROS_PACKAGE_PATH
printenv | grep ROS

# 刷新环境变量
source ~/.bashrc
```

---

## 七、常用组合命令

### 一键启动仿真环境

```bash
# 可以写成脚本 start_sim.sh
#!/bin/bash

# 启动 PX4 + Gazebo（后台）
gnome-terminal -- bash -c "cd ~/PX4-Autopilot && make px4_sitl gazebo; exec bash"

sleep 10  # 等待 PX4 启动

# 启动 MAVROS
gnome-terminal -- bash -c "roslaunch mavros px4.launch fcu_url:='udp://:14540@127.0.0.1:14557'; exec bash"
```

### 监控多个话题

```bash
# 使用 rqt_graph 查看节点连接
rqt_graph

# 使用 rqt_topic 监控话题
rqt_topic

# 使用 rviz 可视化
rviz
```

### 录制和回放

```bash
# 录制话题数据
rosbag record /mavros/local_position/pose /mavros/state -O flight_data.bag

# 回放数据
rosbag play flight_data.bag

# 查看 bag 文件信息
rosbag info flight_data.bag
```

---

## 八、快速参考卡

```
┌────────────────────────────────────────────────────────────────┐
│                    无人机仿真快速参考                           │
├────────────────────────────────────────────────────────────────┤
│  启动仿真                                                      │
│    终端1: cd ~/PX4-Autopilot && make px4_sitl gazebo          │
│    终端2: roslaunch mavros px4.launch fcu_url:="udp://..."    │
│    终端3: python3 your_script.py                              │
├────────────────────────────────────────────────────────────────┤
│  PX4 参数设置                                                  │
│    pxh> param set COM_RCL_EXCEPT 4                            │
│    pxh> param set NAV_RCL_ACT 0                               │
├────────────────────────────────────────────────────────────────┤
│  检查连接                                                      │
│    rostopic echo /mavros/state                                │
│    → connected: True                                          │
├────────────────────────────────────────────────────────────────┤
│  手动控制                                                      │
│    pxh> commander arm                                         │
│    pxh> commander takeoff                                     │
│    pxh> commander land                                        │
├────────────────────────────────────────────────────────────────┤
│  调试                                                          │
│    rostopic list                                              │
│    rostopic hz /mavros/local_position/pose                    │
│    rosnode list                                               │
└────────────────────────────────────────────────────────────────┘
```
